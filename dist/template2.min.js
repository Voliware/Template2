class EventSystem{constructor(){this.events={}}generateRandomString(e){let t="",s=()=>{let e=Math.floor(62*Math.random());return e<10?e:e<36?String.fromCharCode(e+55):String.fromCharCode(e+61)};for(;t.length<e;)t+=s();return t}getHandlersCount(e){let t=this.events[e];if(!t)return 0;let s=0,l=[];for(l.push(t);l.length>0;){let e=l.pop();for(let t in e)"handlers"===t?s+=e[t].length:"object"==typeof e[t]&&l.push(e[t])}return s}on(e,t){let s=e.split("."),l=this.events;for(let e=0;e<s.length;e++){let n=s[e];l[n]||(l[n]={}),e===s.length-1?(Array.isArray(l[n].handlers)||(l[n].handlers=[]),l[n].handlers.push(t)):l=l[n]}}one(e,t){let s=this,l=e+"."+this.generateRandomString(16);this.on(l,function(e){t(e),s.off(l)})}off(e,t=!0){let s=e.split("."),l=this.events;for(let e=0;e<s.length;e++){let n=s[e];e===s.length-1?t?delete l[n]:(delete l[n].handlers,0===Object.keys(l[n]).length&&delete l[n]):l=l[n]}}emit(e,t){let s=e.split("."),l=this.events;for(let e=0;e<s.length;e++){if(!(l=l[s[e]]))return this;if(e===s.length-1){let e=[];for(e.push(l);e.length;){let s=e.pop();for(let l in s)if("handlers"===l)for(let e=0;e<s[l].length;e++)s[l][e](t);else e.push(s[l])}}}}}"undefined"!=typeof module&&(module.exports=EventSystem),Object.setProperties=function(e,t){for(let s in t)e.hasOwnProperty(s)&&(e[s]=t[s]);return e},Object.isEmpty=function(e){return!Object.keys(e).length},Object.extend=function(){let e=arguments[0];if(e)for(let t=1;t<arguments.length;t++){let s=arguments[t];if("object"==typeof s)for(let t in s)if(s.hasOwnProperty(t)){let l=s[t];if(void 0===l)continue;"object"==typeof e[t]&&"object"==typeof l&&e[t]!==l?Object.extend(e[t],l):e[t]=l}}return e},Object.flatten=function(e){let t={};for(let s in e)if(e.hasOwnProperty(s))if("object"==typeof e[s]&&null!==e[s]){let l=Object.flatten(e[s]);for(let e in l)l.hasOwnProperty(e)&&(t[s+"."+e]=l[e])}else t[s]=e[s];return t},Object.unflatten=function(e){let t={};for(let s in e){let l=s.split(".");l.reduce(function(t,n,a){return t[n]||(t[n]=isNaN(Number(l[a+1]))?l.length-1===a?e[s]:{}:[])},t)}return t},document.getElementsByDataName=function(e){return document.querySelectorAll(`[data-name="${e}"]`)},document.getElementByDataName=function(e){let t=document.getElementsByDataName(e);return t.length?t[0]:null};class ElementManager extends EventSystem{constructor({wrapper:e=null,template:t=null,primary_key:s="id",max_elements:l=0,clone_template:n=!0,remove_template:a=!0,remove_dead_templates:i=!0}){super(),this.wrapper=e||document.createElement("div"),this.clone_template=n,this.remove_template=a,this.remove_dead_templates=i,this.primary_key=s,this.max_elements=l,this.template=this.clone_template?t.cloneNode(!0):t,this.template.removeAttribute("id"),this.template.classList.remove("template"),this.remove_template&&t.remove(),this.elements=new Map,this.cached_data=null,this.render_data=null}appendTo(e){Template.append(this.wrapper,e)}getElementCount(){return this.elements.size}empty(){for(;this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild);this.elements=new Map,this.emit("empty")}attachElementHandlers(e){}cloneTemplate(){let e=this.template.cloneNode(!0);return this.attachElementHandlers(e),this.emit("clone",e),e}appendElement(e){this.wrapper.appendChild(e),this.emit("append",e)}removeElement(e){let t=this.elements.get(e);t&&(this.wrapper.removeChild(t),this.elements.delete(e),this.emit("remove",t))}removeDeadElements(e){for(let[t,s]of this.elements)this.getData(e,t)||(s.remove(),this.elements.delete(t),this.emit("remove",s))}getDataType(e){return e instanceof Map?"map":Array.isArray(e)?"array":"object"==typeof e?"object":null}cacheData(e){return Object.extend({},e)}processRenderData(e){return e}getData(e,t){switch(this.getDataType(e)){case"array":let s=e.filter(e=>e[this.primary_key]===t);return s&&s.length?s[0]:null;case"map":return e.get(t);case"object":return e[t];default:return null}}render(e){switch(this.cached_data=this.cacheData(e),this.render_data=this.processRenderData(e),this.getDataType(e)){case"array":this.renderArray(e);break;case"map":this.renderMap(e);break;default:case"object":this.renderObject(e)}this.remove_dead_templates&&this.removeDeadElements(e)}renderArray(e){for(let t=0;t<e.length;t++){let s=e[t][this.primary_key];if(void 0===s)return void console.error("Data must have a primary key property");this.renderElement(s,e[t],t)}}renderMap(e){let t=0;for(let[s,l]of e)this.renderElement(s,l,t),t++}renderObject(e){let t=0;for(let s in e)this.renderElement(s,e[s],t),t++}renderSingle(e,t){let s={};s[e]=t,this.render(s)}renderElement(e,t,s){let l=!1,n=this.elements.get(e);n||(l=!0,n=this.cloneTemplate()),n&&(this.appendElement(n),n instanceof Template?n.render(t):Template.render(n,t),l&&this.elements.set(e,n))}static dataArrayToDataObject(e,t="id"){let s={};for(let l=0;l<e.length;l++){let n=e[l][t];void 0===n?console.error(`dataArrayToDataObject: object does not have required "${t}" value`):s[n]=e[l]}return s}}class Template extends HTMLElement{constructor({elements:e={},render_attribute:t="data-name",display_block:s=!0}={}){super(),this.event_system=new EventSystem,this.native_events={},this.elements=e,this.cached_data=null,this.render_data={},this.is_first_Render=!0,this.render_attribute=t,this.display_block=s}connectedCallback(){if(!this.firstChild){let e=this.createHtml();"string"==typeof e&&(e=e.trim(),this.setHtml(e))}this.display_block&&this.classList.add("template-block"),this.findNamedElements(),this.findElements(this.elements),this.onConnected()}onConnected(){}createHtml(){return null}static addEventSystem(e){e.event_system=new EventSystem,e.native_events={}}static on(e,t,s){let l=t.split(".")[0];e.event_system||Template.addEventSystem(e),0===e.event_system.getHandlersCount(l)&&(e.native_events[l]=(t=>{e.event_system.emit(l,t)}),e.addEventListener(l,e.native_events[l])),e.event_system.on(t,s)}on(e,t){Template.on(this,e,t)}static one(e,t,s){let l=t.split(".")[0];e.event_system||Template.addEventSystem(e),0===e.event_system.getHandlersCount(l)&&(e.native_events[l]=(t=>{e.event_system.emit(l,t),e.removeEventListener(l,e.native_events[l])}),e.addEventListener(l,e.native_events[l])),e.event_system.one(t,s)}one(e,t){Template.one(this,e,t)}static off(e,t,s=!0){if(!(e.event_system instanceof EventSystem))return;let l=t.split(".")[0];e.event_system.off(t,s),0===e.event_system.getHandlersCount(l)&&e.removeEventListener(l,e.native_events[l])}off(e,t=!0){Template.off(this,e,t)}static emit(e,t,s){e.event_system instanceof EventSystem&&e.event_system.emit(t,s)}emit(e,t){Template.emit(this,e,t)}setAttributes(e){for(let t=0;t<e.length;t++){let s=e[t];this.setAttribute(s.name,s.value)}}static findElements(e,t){"object"!=typeof e.elements&&(e.elements={});for(let s in t)"string"==typeof t[s]&&(e.elements[s]=e.querySelector(t[s]));return e.elements}findElements(e){return Template.findElements(this,e)}static findNamedElements(e,t="data-name"){let s={},l=e.querySelectorAll(`[name], [${t}]`);for(let e=0;e<l.length;e++){let n=l[e].getAttribute("name");n||(n=l[e].getAttribute(t)),n&&(s[n]?(Array.isArray(s[n])||(s[n]=[s[n]]),s[n].push(l[e])):s[n]=l[e])}return s}findNamedElements(){let e=Template.findNamedElements(this,this.render_attribute);Object.extend(this.elements,e)}getElements(){return this.elements}static select(e,t){return"string"==typeof e&&(t=e,e=document.documentElement),e.querySelectorAll(t)}select(e){return Template.select(this,e)}static selectFirst(e,t){let s=Template.select(e,t);return s instanceof NodeList&&s.length?s[0]:null}selectFirst(e){return Template.selectFirst(this,e)}static selectLast(e,t){let s=Template.select(e,t);return s instanceof NodeList&&s.length?s[s.length-1]:null}selectLast(e){return Template.selectLast(e)}static append(e,t){t.appendChild(e)}append(e){Template.append(e,this)}appendTo(e){Template.append(this,e)}static prepend(e,t){t.firstChild&&t.insertBefore(e,t.firstChild)}prepend(e){Template.prepend(e,this)}prependTo(e){Template.prepend(this,e)}static empty(e){for(;this.element;)e.removeChild(e.firstChild)}empty(){Template.empty(this)}static isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}isVisible(){return Template.isVisible(this)}static hide(e){"none"!==e.style.display&&(e.previous_display=e.style.display),e.style.display="none"}hide(){Template.hide(this)}static show(e){e.style.display=e.previous_display||"block"}show(){Template.show(this)}static display(e,t){return void 0===t&&(t=!Template.isVisible(e)),t?Template.show(e):Template.hide(e)}display(e){Template.display(this,e)}static getStyle(e,t){return window.getComputedStyle(e).getPropertyValue(t)}getStyle(e){return Template.getStyle(this,e)}static setHeight(e,t){"number"==typeof t&&(t+="px"),e.style.height=t}setHeight(e){Template.setHeight(this,e)}static setWidth(e,t){"number"==typeof t&&(t+="px"),e.style.width=t}setWidth(e){Template.setWidth(this,e)}static setTop(e,t){"number"==typeof t&&(t+="px"),e.style.top=t}setTop(e){Template.setTop(this,e)}static setRight(e,t){"number"==typeof t&&(t+="px"),e.style.right=t}setRight(e){Template.setRight(this,e)}static setBottom(e,t){"number"==typeof t&&(t+="px"),e.style.bottom=t}setBottom(e){Template.setBottom(this,e)}static setLeft(e,t){"number"==typeof t&&(t+="px"),e.style.left=t}setLeft(e){Template.setLeft(this,e)}static setPosition(e,{top:t,left:s,bottom:l,right:n}){void 0!==t&&Template.setTop(e,t),void 0!==s&&Template.setLeft(e,s),void 0!==l&&Template.setBottom(e,l),void 0!==n&&Template.setRight(e,n)}setPosition({top:e,left:t,bottom:s,right:l}){Template.setPosition(this,{top:e,left:t,bottom:s,right:l})}static addClass(e,t){e.classList.add(t)}addClass(e){Template.addClass(this,e)}static hasClass(e,t){return e.classList.contains(t)}hasClass(e){return Template.hasClass(this,e)}static removeClass(e,t){e.classList.remove(t)}removeClass(e){Template.removeClass(this,e)}static replaceClass(e,t,s){e.classList.replace(t,s)}replaceClass(e,t){Template.replaceClass(this,e,t)}static toggleClass(e,t,s){e.classList.toggle(t,s)}toggleClass(e,t){return Template.toggleClass(this,e,t),this}static getValue(e){return e.value}getValue(){return Template.getValue(this)}static setValue(e,t){e.value=t}setValue(e){Template.setValue(this,e)}static enable(e){e.disabled=!1}enable(){Template.enable(this)}static disable(e){e.disabled=!0}disable(){Template.disable(this)}cacheData(e){return Object.extend({},e)}processRenderData(e){return e}static setHtml(e,t){e.innerHTML=t}setHtml(e){Template.setHtml(this,e)}static render(e,t,s=!1){let l=null;l=s?e.getElements():Template.findNamedElements(e);let n=Object.flatten(t);for(let t in n){let a=n[t],i=l[t];if(i||(s&&(e.findNamedElements(),i=l[t]),i))if(i.render)i.render(a);else{Array.isArray(i)||(i=[i]);for(let e=0;e<i.length;e++){let t=i[e];if("false"!==t.getAttribute("data-render"))if("INPUT"===t.tagName){let e=t.getAttribute("type");e?"checkbox"===e&&a?t.checked=!0:"radio"===e?t.getAttribute("value")===a&&(t.checked=!0):t.value=a:t.value=a}else"SELECT"===t.tagName?t.value=a:t.innerHTML=a}}}}render(e){this.cached_data=this.cacheData(e),this.render_data=this.processRenderData(Object.extend({},e)),Template.render(this,this.render_data,!0),this.is_first_Render=!1}static clone(e){let t=e.cloneNode();return t.innerHTML=e.innerHTML,t}clone(){return Template.clone(this)}}customElements.define("template-element",Template);